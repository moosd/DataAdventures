#!/bin/bash

# $1 - from
# $2 - to

curl 'http://www.thetrainline.com/buytickets/' -H 'Host: www.thetrainline.com' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:40.0) Gecko/20100101 Firefox/40.0 Iceweasel/40.0a2' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'Referer: http://www.thetrainline.com/' -H 'Cookie: SSID=CAAeYB0AAAAAAABDjr5Vn97BGEOOvlUBAAAAAAAAAAAAQ46-VQCB4A; SSSC=266.G6178532157628210847.1|0.0; SSRT=AI--VQADAQ; language=en-GB; ASP.NET_SessionId=bvupf2m44an1hwxljynwoae1; DotNetNukeAnonymous=4b315ca7-d0fe-447c-a3e6-f1614fd3bbaf; .ASPXANONYMOUS=77mbzUD6bFyMF6zvkwDzvXKlQaChYPyEMxaoKZEmL5xdQH_JzVCtjiiSEthBw3G2mk5JKckTpiQAb23CIKs8YDDKYtbAiOsnyNAYDEijYMG40RuAKFZCEurZ2zNUK-bZXh8Qxw2; CO=4592509821; RNCU=; ASPSESSIONIDASBCDRBS=GIAOICPCFLPKAJKDBGANPEIP; eu_cookies_visi=false; s_cc=true; prevPage=default; s_nr_personal=1438551835500-New; s_cmgvo_personal_dl=1; s_cmpid=%7C%7C%7C%7C; s_loggedin=Logged%20Out; s_sq=tlntrainlineprod%3D%2526pid%253Ddefault%2526pidt%253D1%2526oid%253DGet%252520times%252520%252526%252520tickets%2526oidt%253D3%2526ot%253DSUBMIT; NSC_QSE!uifusbjomjof-dpoufouipnf!MC=ffffffff09fc779f45525d5f4f58455e445a4a423660' -H 'Connection: keep-alive' --data "OriginStation=$1&DestinationStation=$2&RouteRestriction=NULL&ViaAvoidStation=&outwardDate=03-Aug-15&OutwardLeaveAfterOrBefore=A&OutwardHour=12&OutwardMinute=45&returnDate=&InwardLeaveAfterOrBefore=A&ReturnHour=&ReturnMinute=&AdultsTravelling=1&ChildrenTravelling=0&ExtendedSearch=Get+times+%26+tickets"
curl 'http://www.thetrainline.com/buytickets/matrix.aspx?BackPageUrl=http%3a%2f%2fwww.thetrainline.com%2f' -H 'Host: www.thetrainline.com' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:40.0) Gecko/20100101 Firefox/40.0 Iceweasel/40.0a2' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'Referer: http://www.thetrainline.com/' -H 'Cookie: SSID=CAAeYB0AAAAAAABDjr5Vn97BGEOOvlUBAAAAAAAAAAAAQ46-VQCB4B; SSSC=266.G6178532157628210848.1|0.0; SSRT=AI--VQADBQ; language=en-GB; ASP.NET_SessionId=bvupf2m44an1hwxljynwoaf1; DotNetNukeAnonymous=4b335ca7-d0fe-447c-a3e6-f1614fd3bbaf; .ASPXANONYMOUS=8nynK_4D0QEkAAAAZWVkZGE0YTEtNGFiNy00M2NhLWJkNDYtMTMyNmFhZTdlYjY50; CO=4692509821; RNCU=; ASPSESSIONIDASBCDRBS=GIAONCPCFLPKAJKDBGANPEIP; eu_cookies_visi=false; s_cc=true; prevPage=default; s_nr_personal=1438551835510-New; s_cmgvo_personal_dl=1; s_cmpid=%7C%7C%7C%7C; s_loggedin=Logged%20Out; s_sq=tlntrainlineprod%3D%2526pid%253Ddefault%2526pidt%253D1%2526oid%253DGet%252520times%252520%252526%252520tickets%2526oidt%253D3%2526ot%253DSUBMIT; NSC_QSE!ujfusbjomjof-dpoufouipnf!MC=ffffffff09fd779f45525d5f4f58455e445a4a423660' -H 'Connection: keep-alive'
curl 'http://www.thetrainline.com/buytickets/combinedmatrix.aspx?Command=TimeTable' -H 'Host: www.thetrainline.com' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:40.0) Gecko/20100101 Firefox/40.0 Iceweasel/40.0a2' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'Referer: http://www.thetrainline.com/' -H 'Cookie: SSID=CAAeYB0AAAAAAABDjr5Vn97BGEOOvlUBAAAAAAAAAAAAQ46-VQCB4B; SSSC=266.G6178532157628210848.1|0.0; SSRT=AI--VQADBQ; language=en-GB; ASP.NET_SessionId=bvupf2m44an1hwxljynwoaf1; DotNetNukeAnonymous=4b335ca7-d0fe-447c-a3e6-f1614fd3bbaf; .ASPXANONYMOUS=8nynK_4D0QEkAAAAZWVkZGE0YTEtNGFiNy00M2NhLWJkNDYtMTMyNmFhZTdlYjY50; CO=4692509821; RNCU=; ASPSESSIONIDASBCDRBS=GIAONCPCFLPKAJKDBGANPEIP; eu_cookies_visi=false; s_cc=true; prevPage=default; s_nr_personal=1438551835510-New; s_cmgvo_personal_dl=1; s_cmpid=%7C%7C%7C%7C; s_loggedin=Logged%20Out; s_sq=tlntrainlineprod%3D%2526pid%253Ddefault%2526pidt%253D1%2526oid%253DGet%252520times%252520%252526%252520tickets%2526oidt%253D3%2526ot%253DSUBMIT; NSC_QSE!ujfusbjomjof-dpoufouipnf!MC=ffffffff09fd779f45525d5f4f58455e445a4a423660' -H 'Connection: keep-alive' > /dev/null

data=$(curl 'http://www.thetrainline.com/buytickets/CombinedMatrixAjaxController.ashx?Command=YieldTickets&_=1438551838660' -H 'Host: www.thetrainline.com' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:40.0) Gecko/20100101 Firefox/40.0 Iceweasel/40.0a2' -H 'Accept: text/plain, */*; q=0.01' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'X-NewRelic-ID: UAcAUVNUGwcJUlNWAwN=' -H 'X-Requested-With: XMLHttpRequest' -H 'Referer: http://www.thetrainline.com/buytickets/combinedmatrix.aspx?Command=TimeTable' -H 'Cookie: SSID=CAAeYB0AAAAAAABDjr5Vn97BGEOOvlUBAAAAAAAAAAAAQ46-VQCB4B; SSSC=266.G6178532157628210848.1|0.0; SSRT=AI--VQADBQ; language=en-GB; ASP.NET_SessionId=bvupf2m44an1hwxljynwoaf1; DotNetNukeAnonymous=4b335ca7-d0fe-447c-a3e6-f1614fd3bbaf; .ASPXANONYMOUS=8nynK_4D0QEkAAAAZWVkZGE0YTEtNGFiNy00M2NhLWJkNDYtMTMyNmFhZTdlYjY50; CO=4692509821; RNCU=; ASPSESSIONIDASBCDRBS=GIAONCPCFLPKAJKDBGANPEIP; eu_cookies_visi=false; s_cc=true; prevPage=default; s_nr_personal=1438551835510-New; s_cmgvo_personal_dl=1; s_cmpid=%7C%7C%7C%7C; s_loggedin=Logged%20Out; s_sq=tlntrainlineprod%3D%2526pid%253Ddefault%2526pidt%253D1%2526oid%253DGet%252520times%252520%252526%252520tickets%2526oidt%253D3%2526ot%253DSUBMIT; NSC_QSE!ujfusbjomjof-dpoufouipnf!MC=ffffffff09fd779f45525d5f4f58455e445a4a423660' -H 'Connection: keep-alive' | sed 's/,/\n/g' |grep price|cut -d':' -f2|sed 's/"//g')

echo "$data"

cheapest=99999
while read l; do
if (( $(echo "$l < $cheapest" | bc -l) )); then
cheapest="$l"
fi
done<<<"$data"

echo -n "CHEAPEST:"
echo $cheapest

#echo "$1,$cheapest" >> prices
